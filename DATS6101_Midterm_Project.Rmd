---
title: "DATS6101 Midterm Project: Modeling Airline Passenger Satisfaction"
author: "Jehan Bugli"
date: "2023-10-15"
output: 
  html_document:
    fig_width: 14
    fig_height: 6
  
---
```{r init, include=F}
# Install packages
#install.packages(c('ezids', 'Hmisc', 'ggplot2', 'dplyr', 'pals'))
# Load the ezids package for functions like xkabledply(), xkablesummary(), uzscale(), etc.
library(ezids)
# Load package for "describe" function
library("Hmisc")
# Load ggplot2 package
library(ggplot2)
# Load dplyr package
library(dplyr)
# Load car package for VIF
library(car)

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r import_data}
# Get working directory
getwd()
# Import train.csv data as a data frame
data_raw <- data.frame(read.csv("train.csv", header = TRUE))
# Get initial description of the data
str(data_raw)
header <- xkabledplyhead(data_raw, title = "Header rows for airline passenger dataset")
header


```
```{r filter_data}
# Get unnecessary columns
drop <- c("X","id")
# Drop column names specified in vector
data <- data_raw[,!(names(data_raw) %in% drop)]

#Select ratings columns
selected_columns <- 7:20

# Check if any ratings include zeros (representing N/A)
has_zeros <- apply(data[selected_columns], 1, function(row) any(row == 0))

# Remove rows with zeros in the selected columns
data <- data[!has_zeros, ]

# Get header for filtered dataset
header <- xkabledplyhead(data, title = "Header rows for airline passenger dataset")
header
summary <- xkablesummary(data, title = "Summary of airline passenger dataset")
summary
```


## EDA: Ratings variables

```{r ratings histogram}

# Define ratings subset of main data frame
data_ratings <- data[7:20]

# Reshape the data into a long format
data_long <- tidyr::gather(data_ratings, variable, value)

colors <- c(
  "red", "blue", "green", "purple", "orange",
  "pink", "gray", "yellow", "cyan", "magenta",
  "brown", "violet", "turquoise", "pink"
)


# Create a clustered histogram with color-separated columns
ggplot(data_long, aes(x = value, fill = variable)) +
  # geom_histogram(binwidth = 0.5, position = "dodge", alpha = 0.7, width = 10) +
  geom_histogram(binwidth = 0.5, position = position_dodge(0.7), alpha = 0.7)
  labs(x = "Value", y = "Frequency") +
  scale_fill_manual(values = colors) +
  theme_minimal()
```

```{r ratings matrix, fig.width = 15, fig.height = 20}
  
# Create a correlation matrix
cor_matrix <- cor(data_ratings)

# Visualize the correlation matrix
loadPkg("corrplot") 

corrplot.mixed(
  cor_matrix,  
  lower = "number",
  upper = "circle",
  tl.pos = "lt",
  tl.cex = 1,
  title="Correlation Matrix for 5-Point Ratings", 
  
  mar=c(0,0,1,0) # fixes the position of title 
  
  ) 

```